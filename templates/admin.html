<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel de Administrador</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="admin-header">
      <h1>ğŸ›¡ï¸ Panel de Administrador</h1>
      <div class="admin-nav">
        <a href="/dashboard" class="nav-link">Dashboard</a>
          <button onclick="showEditBannerModal()" class="nav-link edit-banner-btn" style="background: none; border: none; color: white; cursor: pointer; padding: 0.5rem 1rem; text-decoration: none;">âœï¸ Editar Banner</button>
          <a href="/logout" class="nav-link">Cerrar sesiÃ³n</a>
      </div>
    </div>
  </header>

  <!-- Banner informativo -->
  <section class="info-banner">
    <div class="marquee-text">
      ğŸ›¡ï¸ PANEL ADMIN: GameStore Management System ğŸ›¡ï¸ GestiÃ³n completa de usuarios y transacciones ğŸ›¡ï¸ SupervisiÃ³n en tiempo real de todas las operaciones ğŸ›¡ï¸
    </div>
  </section>

  <!-- Panel de administrador con pestaÃ±as -->
  <section class="admin-panel">
    <div class="admin-stats">
      <div class="stat-card">
        <h3>Total Usuarios</h3>
        <span id="total-users">{{ users|length if users else 0 }}</span>
      </div>
      <div class="stat-card">
        <h3>Usuarios Activos</h3>
        <span id="active-users">{{ users|selectattr('is_active')|list|length if users else 0 }}</span>
      </div>
      <div class="stat-card">
        <h3>PINEs Disponibles</h3>
        <span id="available-pins">{{ pins_stats|sum(attribute='available') if pins_stats else 0 }}</span>
      </div>
    </div>

    <!-- PestaÃ±as -->
    <div class="tab-container">
      <div class="tab-buttons">
        <button class="tab-button active" onclick="showTab('users')">ğŸ‘¥ Usuarios</button>
        <button class="tab-button" onclick="showTab('pins')">ğŸ“Œ Agregar PINÃ©s</button>
        <button class="tab-button" onclick="showTab('precios')">ğŸ’° Precios</button>
      </div>

      <!-- PestaÃ±a de Usuarios -->
      <div id="users-tab" class="tab-content active">
        <div class="users-section">
          <h2>GestiÃ³n de Usuarios</h2>
          <button onclick="refreshUsers()" class="btn-refresh">ğŸ”„ Actualizar</button>

          <div class="table-mobile-hint">
            ğŸ“± En mÃ³vil: desliza la tabla horizontalmente para ver todas las columnas
          </div>

          <div class="users-table-container">
            <table class="users-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nombre</th>
                  <th>Email</th>
                  <th>TelÃ©fono</th>
                  <th>Saldo</th>
                  <th>Estado</th>
                  <th>Registro</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="users-tbody">
                {% if users %}
                  {% for user in users %}
                  <tr data-user-id="{{ user.user_id }}">
                    <td>{{ user.user_id }}</td>
                    <td>{{ user.nombre }} {{ user.apellido }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.telefono }}</td>
                    <td class="balance">${{ user.balance }}</td>
                    <td>
                      <span class="status {{ 'active' if user.is_active else 'inactive' }}">
                        {{ 'Activo' if user.is_active else 'Inactivo' }}
                      </span>
                    </td>
                    <td>{{ user.created_at.strftime('%d/%m/%Y') if user.created_at else '---' }}</td>
                    <td class="actions">
                      <button onclick="showCreditModal('{{ user.user_id }}', '{{ user.nombre }} {{ user.apellido }}')" 
                              class="btn-action btn-credit">ğŸ’°</button>
                      <button onclick="showBalanceModal('{{ user.user_id }}', '{{ user.nombre }} {{ user.apellido }}', '{{ user.balance }}')" 
                              class="btn-action btn-balance">âœï¸</button>
                      <button onclick="toggleUserStatus('{{ user.user_id }}', {{ 'false' if user.is_active else 'true' }})" 
                              class="btn-action btn-toggle">
                        {{ 'ğŸ”’' if user.is_active else 'ğŸ”“' }}
                      </button>
                      <button onclick="deleteUser('{{ user.user_id }}', '{{ user.nombre }} {{ user.apellido }}')" 
                              class="btn-action btn-delete">ğŸ—‘ï¸</button>
                    </td>
                  </tr>
                  {% endfor %}
                {% else %}
                  <tr>
                    <td colspan="8" class="no-users">No hay usuarios registrados</td>
                  </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- PestaÃ±a de PINÃ©s -->
      <div id="pins-tab" class="tab-content">
        <div class="pins-section">
          <h2>GestiÃ³n de PINÃ©s</h2>

          <!-- Formulario para agregar PINÃ©s -->
          <div class="add-pins-form">
            <h3>â• Agregar Nuevo PIN</h3>
            <form onsubmit="addSinglePin(event)">
              <div class="form-row">
                <div class="form-group">
                  <label for="pin-code">ğŸ”‘ CÃ³digo del PIN:</label>
                  <input type="text" id="pin-code" placeholder="Ej: ABC123XY" maxlength="20" required autocomplete="off">
                </div>
                <div class="form-group">
                  <label for="pin-value">ğŸ’° Valor del PIN:</label>
                  <select id="pin-value" required>
                    <option value="">-- Seleccionar valor --</option>
                    <option value="1">ğŸ’ 110 diamantes - $0.66</option>
                    <option value="2">ğŸ’ 341 diamantes - $1.99</option>
                    <option value="3">ğŸ’ 572 diamantes - $3.35</option>
                    <option value="4">ğŸ’ 1.166 diamantes - $6.70</option>
                    <option value="5">ğŸ’ 2.376 diamantes - $12.70</option>
                    <option value="6">ğŸ’ 6.138 diamantes - $29.50</option>
                    <option value="7">ğŸ« Tarjeta bÃ¡sica - $0.40</option>
                    <option value="8">ğŸ« Tarjeta semanal - $1.40</option>
                    <option value="9">ğŸ« Tarjeta mensual - $6.50</option>
                  </select>
                </div>
                <div class="form-group">
                  <button type="submit" class="btn btn-success">âœ… Agregar PIN</button>
                </div>
              </div>
            </form>
          </div>

          <!-- EstadÃ­sticas de PINÃ©s -->
          <div class="pins-stats">
            <h3>EstadÃ­sticas de PINÃ©s</h3>
            <div class="stats-grid">
              {% if pins_stats %}
                {% for stat in pins_stats %}
                <div class="stat-item">
                  <div class="stat-value">${{ stat.value }}</div>
                  <div class="stat-details">
                    <span class="available">{{ stat.available }} disponibles</span>
                    <span class="used">{{ stat.used }} usados</span>
                    <span class="total">{{ stat.total }} total</span>
                  </div>
                </div>
                {% endfor %}
              {% else %}
                <p>No hay PINÃ©s en el sistema</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <!-- PestaÃ±a de Precios -->
      <div id="precios-tab" class="tab-content">
        <div class="precios-section">
          <h2>GestiÃ³n de Precios</h2>
          <p>Actualiza los precios de los paquetes de juegos en tiempo real.</p>

          <!-- Free Fire Latam -->
          <div class="game-prices-section">
            <h3>ğŸ”¥ Free Fire Latam</h3>
            <div class="prices-grid" id="freefire-prices">
              <div class="price-item">
                <label>110 ğŸ’ Diamantes:</label>
                <span>$</span>
                <input type="number" step="0.01" min="0" data-option="1" class="price-input-ff" placeholder="0.66">
              </div>
              <div class="price-item">
                <label>341 ğŸ’ Diamantes:</label>
                <span>$</span>
                <input type="number" step="0.01" min="0" data-option="2" class="price-input-ff" placeholder="1.99">
              </div>
              <div class="price-item">
                <label>572 ğŸ’ Diamantes:</label>
                <span>$</span>
                <input type="number" step="0.01" min="0" data-option="3" class="price-input-ff" placeholder="3.35">
              </div>
              <div class="price-item">
                <label>1.166 ğŸ’ Diamantes:</label>
                <span>$</span>
                <input type="number" step="0.01" min="0" data-option="4" class="price-input-ff" placeholder="6.70">
              </div>
              <div class="price-item">
                <label>2.376 ğŸ’ Diamantes:</label>
                <span>$</span>
                <input type="number" step="0.01" min="0" data-option="5" class="price-input-ff" placeholder="12.70">
              </div>
              <div class="price-item">
                <label>6.138 ğŸ’ Diamantes:</label>
                <span>$</span>
                <input type="number" step="0.01" min="0" data-option="6" class="price-input-ff" placeholder="29.50">
              </div>
              <div class="price-item">
                <label>ğŸ« Tarjeta BÃ¡sica:</label>
                <span>$</span>
                <input type="number" step="0.01" min="0" data-option="7" class="price-input-ff" placeholder="0.40">
              </div>
              <div class="price-item">
                <label>ğŸ« Tarjeta Semanal:</label>
                <span>$</span>
                <input type="number" step="0.01" min="0" data-option="8" class="price-input-ff" placeholder="1.40">
              </div>
              <div class="price-item">
                <label>ğŸ« Tarjeta Mensual:</label>
                <span>$</span>
                <input type="number" step="0.01" min="0" data-option="9" class="price-input-ff" placeholder="6.50">
              </div>
            </div>
            <div class="price-actions">
              <button onclick="updateFreefirePrices()" class="btn btn-success">ğŸ’¾ Guardar Precios Free Fire</button>
              <button onclick="loadCurrentPrices('freefire_latam', true)" class="btn btn-secondary">ğŸ”„ Cargar Precios Actuales</button>
            </div>
          </div>

          <!-- Block Striker -->
          <div class="game-prices-section">
            <h3>âš¡ Block Striker</h3>
            <div class="prices-grid" id="blockstriker-prices">
              <div class="price-item">
                <label>100+16 ğŸª™ Monedas:</label>
                <span>$</span>
                <input type="number" step="0.01" min="0" data-option="1" class="price-input-bs" placeholder="0.82">
              </div>
              <div class="price-item">
                <label>300+52 ğŸª™ Monedas:</label>
                <span>$</span>
                <input type="number" step="0.01" min="0" data-option="2" class="price-input-bs" placeholder="2.60">
              </div>
              <div class="price-item">
                <label>500+94 ğŸª™ Monedas:</label>
                <span>$</span>
                <input type="number" step="0.01" min="0" data-option="3" class="price-input-bs" placeholder="4.30">
              </div>
              <div class="price-item">
                <label>1,000+210 ğŸª™ Monedas:</label>
                <span>$</span>
                <input type="number" step="0.01" min="0" data-option="4" class="price-input-bs" placeholder="8.65">
              </div>
              <div class="price-item">
                <label>2,000+486 ğŸª™ Monedas:</label>
                <span>$</span>
                <input type="number" step="0.01" min="0" data-option="5" class="price-input-bs" placeholder="17.30">
              </div>
              <div class="price-item">
                <label>5,000+1,380 ğŸª™ Monedas:</label>
                <span>$</span>
                <input type="number" step="0.01" min="0" data-option="6" class="price-input-bs" placeholder="43.15">
              </div>
              <div class="price-item">
                <label>ğŸ–ï¸ Pase Elite:</label>
                <span>$</span>
                <input type="number" step="0.01" min="0" data-option="7" class="price-input-bs" placeholder="3.50">
              </div>
              <div class="price-item">
                <label>ğŸ–ï¸ Pase Elite Plus:</label>
                <span>$</span>
                <input type="number" step="0.01" min="0" data-option="8" class="price-input-bs" placeholder="8.00">
              </div>
              <div class="price-item">
                <label>ğŸ”« Pase de Mejora:</label>
                <span>$</span>
                <input type="number" step="0.01" min="0" data-option="9" class="price-input-bs" placeholder="1.85">
              </div>
            </div>
            <div class="price-actions">
              <button onclick="updateBlockStrikerPrices()" class="btn btn-success">ğŸ’¾ Guardar Precios Block Striker</button>
              <button onclick="loadCurrentPrices('block_striker', true)" class="btn btn-secondary">ğŸ”„ Cargar Precios Actuales</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Modal para agregar crÃ©dito -->
  <div id="creditModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="closeCreditModal()">&times;</span>
      <h3>Agregar CrÃ©dito</h3>
      <p>Usuario: <span id="credit-user-name"></span></p>
      <div class="form-group">
        <label for="credit-amount">Monto a agregar:</label>
        <input type="number" id="credit-amount" min="0.01" step="0.01" placeholder="0.00">
      </div>
      <div class="modal-actions">
        <button onclick="addCredit()" class="btn btn-success">Agregar CrÃ©dito</button>
        <button onclick="closeCreditModal()" class="btn btn-cancel">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal para editar saldo -->
  <div id="balanceModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" onclick="closeBalanceModal()">&times;</span>
      <h3>Editar Saldo</h3>
      <p>Usuario: <span id="balance-user-name"></span></p>
      <p>Saldo actual: $<span id="current-balance"></span></p>
      <div class="form-group">
        <label for="new-balance">Nuevo saldo:</label>
        <input type="number" id="new-balance" min="0" step="0.01" placeholder="0.00">
      </div>
      <div class="modal-actions">
        <button onclick="setBalance()" class="btn btn-success">Actualizar Saldo</button>
        <button onclick="closeBalanceModal()" class="btn btn-cancel">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal de confirmaciÃ³n -->
  <div id="confirmModal" class="modal" style="display: none;">
    <div class="modal-content">
      <h3 id="confirm-title">Confirmar acciÃ³n</h3>
      <p id="confirm-message"></p>
      <div class="modal-actions">
        <button id="confirm-btn" class="btn btn-danger">Confirmar</button>
        <button onclick="closeConfirmModal()" class="btn btn-cancel">Cancelar</button>
      </div>
    </div>
  </div>

    <!-- Modal para editar banner -->
    <div id="editBannerModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeEditBannerModal()">&times;</span>
            <h3>Editar Texto del Banner</h3>
            <div class="form-group">
                <label for="banner-text">Nuevo texto del banner:</label>
                <input type="text" id="banner-text" placeholder="Ingrese el nuevo texto aquÃ­">
            </div>
            <div class="modal-actions">
                <button onclick="updateBannerText()" class="btn btn-success">Actualizar Banner</button>
                <button onclick="closeEditBannerModal()" class="btn btn-cancel">Cancelar</button>
            </div>
        </div>
    </div>

  <script>
    let selectedUserId = null;

    // Mapeo de valores a precios reales (igual que en freefirelatam.html)
    const priceMapping = {
      '1': 0.66,  // 110 ğŸ’
      '2': 1.99,  // 341 ğŸ’  
      '3': 3.35,  // 572 ğŸ’
      '4': 6.70,  // 1.166 ğŸ’
      '5': 12.70, // 2.376 ğŸ’
      '6': 29.50, // 6.138 ğŸ’
      '7': 0.40,  // Tarjeta bÃ¡sica
      '8': 1.40,  // Tarjeta semanal
      '9': 6.50   // Tarjeta mensual
    };

    function showTab(tabName) {
      // Ocultar todas las pestaÃ±as
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });

      // Mostrar la pestaÃ±a seleccionada
      document.getElementById(tabName + '-tab').classList.add('active');
      event.target.classList.add('active');
    }

    function refreshUsers() {
      location.reload();
    }

    async function addSinglePin(event) {
      event.preventDefault();

      const pinCode = document.getElementById('pin-code').value.trim().toUpperCase();
      const optionValue = document.getElementById('pin-value').value;

      if (!pinCode || !optionValue) {
        alert('Por favor completa todos los campos');
        return;
      }

      if (pinCode.length < 4) {
        alert('El PIN debe tener al menos 4 caracteres');
        return;
      }

      const realPrice = priceMapping[optionValue];
      if (!realPrice) {
        alert('Valor de opciÃ³n invÃ¡lido');
        return;
      }

      try {
        const response = await fetch('/admin/add-single-pin', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            pin_code: pinCode,
            value: parseInt(optionValue) // Enviar el valor de opciÃ³n (1-9)
          })
        });

        const data = await response.json();

        if (data.success) {
          alert(`PIN "${pinCode}" de opciÃ³n ${optionValue} ($${realPrice}) agregado exitosamente`);
          document.getElementById('pin-code').value = '';
          document.getElementById('pin-value').value = '';
          location.reload();
        } else {
          alert(data.error);
        }
      } catch (error) {
        alert('Error al agregar PIN');
      }
    }

    function showCreditModal(userId, userName) {
      selectedUserId = userId;
      document.getElementById('credit-user-name').textContent = userName;
      document.getElementById('creditModal').style.display = 'block';
    }

    function closeCreditModal() {
      document.getElementById('creditModal').style.display = 'none';
      document.getElementById('credit-amount').value = '';
      selectedUserId = null;
    }

    function showBalanceModal(userId, userName, currentBalance) {
      selectedUserId = userId;
      document.getElementById('balance-user-name').textContent = userName;
      document.getElementById('current-balance').textContent = currentBalance;
      document.getElementById('new-balance').value = currentBalance;
      document.getElementById('balanceModal').style.display = 'block';
    }

    function closeBalanceModal() {
      document.getElementById('balanceModal').style.display = 'none';
      document.getElementById('new-balance').value = '';
      selectedUserId = null;
    }

    function closeConfirmModal() {
      document.getElementById('confirmModal').style.display = 'none';
    }

        function showEditBannerModal() {
            document.getElementById('editBannerModal').style.display = 'block';
        }

        function closeEditBannerModal() {
            document.getElementById('editBannerModal').style.display = 'none';
            document.getElementById('banner-text').value = '';
        }

        async function updateBannerText() {
            const bannerText = document.getElementById('banner-text').value;

            if (!bannerText) {
                alert('Por favor, ingrese el nuevo texto para el banner.');
                return;
            }

            try {
                const response = await fetch('/admin/update-banner', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ banner_text: bannerText })
                });

                const data = await response.json();

                if (data.success) {
                    // Actualizar el texto del banner en la pÃ¡gina
                    document.querySelector('.marquee-text').textContent = bannerText;
                    alert('Texto del banner actualizado con Ã©xito.');
                    closeEditBannerModal();
                } else {
                    alert(data.error);
                }
            } catch (error) {
                alert('Error al actualizar el texto del banner: ' + error);
            }
        }

    async function addCredit() {
      const amount = document.getElementById('credit-amount').value;

      if (!amount || amount <= 0) {
        alert('Por favor ingresa un monto vÃ¡lido');
        return;
      }

      try {
        const response = await fetch(`/admin/user/${selectedUserId}/add-credit`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            user_id: selectedUserId,
            amount: amount
          })
        });

        const data = await response.json();

        if (data.success) {
          const row = document.querySelector(`tr[data-user-id="${selectedUserId}"]`);
          const balanceCell = row.querySelector('.balance');
          balanceCell.textContent = '$' + data.new_balance;

          alert(data.message);
          closeCreditModal();
        } else {
          alert(data.error);
        }
      } catch (error) {
        alert('Error al agregar crÃ©dito');
      }
    }

    async function setBalance() {
      const newBalance = document.getElementById('new-balance').value;

      if (newBalance === '' || newBalance < 0) {
        alert('Por favor ingresa un saldo vÃ¡lido');
        return;
      }

      try {
        const response = await fetch(`/admin/user/${selectedUserId}/set-balance`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            balance: newBalance
          })
        });

        const data = await response.json();

        if (data.success) {
          const row = document.querySelector(`tr[data-user-id="${selectedUserId}"]`);
          const balanceCell = row.querySelector('.balance');
          balanceCell.textContent = '$' + data.new_balance;

          alert(data.message);
          closeBalanceModal();
        } else {
          alert(data.error);
        }
      } catch (error) {
        alert('Error al actualizar saldo');
      }
    }

    function toggleUserStatus(userId, activate) {
      const action = activate === 'true' ? 'activate' : 'deactivate';
      const message = activate === 'true' ? 'Â¿Activar este usuario?' : 'Â¿Desactivar este usuario?';

      document.getElementById('confirm-title').textContent = 'Cambiar estado de usuario';
      document.getElementById('confirm-message').textContent = message;
      document.getElementById('confirm-btn').onclick = () => executeToggleUser(userId, action);
      document.getElementById('confirmModal').style.display = 'block';
    }

    async function executeToggleUser(userId, action) {
      try {
        const response = await fetch(`/admin/user/${userId}/toggle`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            user_id: userId,
            action: action
          })
        });

        const data = await response.json();

        if (data.success) {
          location.reload();
        } else {
          alert(data.error);
        }
      } catch (error) {
        alert('Error al cambiar estado del usuario');
      }

      closeConfirmModal();
    }

    function deleteUser(userId, userName) {
      document.getElementById('confirm-title').textContent = 'Eliminar usuario';
      document.getElementById('confirm-message').textContent = `Â¿EstÃ¡s seguro de eliminar al usuario "${userName}"? Esta acciÃ³n no se puede deshacer.`;
      document.getElementById('confirm-btn').onclick = () => executeDeleteUser(userId);
      document.getElementById('confirmModal').style.display = 'block';
    }

    async function executeDeleteUser(userId) {
      try {
        const response = await fetch(`/admin/user/${userId}/delete`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            user_id: userId
          })
        });

        const data = await response.json();

        if (data.success) {
          location.reload();
        } else {
          alert(data.error);
        }
      } catch (error) {
        alert('Error al eliminar usuario');
      }

      closeConfirmModal();
    }

    // Cerrar modales al hacer clic fuera
    window.onclick = function(event) {
      if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
      }
    }

    // Funciones para gestiÃ³n de precios
    async function loadCurrentPrices(gameType, showAlert = false) {
      try {
        const response = await fetch('/admin/get-game-prices');
        const data = await response.json();

        if (data.success) {
          const prices = data.prices[gameType] || {};
          const className = gameType === 'freefire_latam' ? 'price-input-ff' : 'price-input-bs';
          
          document.querySelectorAll(`.${className}`).forEach(input => {
            const option = input.getAttribute('data-option');
            if (prices[option]) {
              input.value = prices[option];
            }
          });
          
          if (showAlert) {
            alert(`Precios de ${gameType === 'freefire_latam' ? 'Free Fire Latam' : 'Block Striker'} cargados`);
          }
        } else {
          if (showAlert) {
            alert('Error cargando precios: ' + data.error);
          }
        }
      } catch (error) {
        if (showAlert) {
          alert('Error al cargar precios: ' + error);
        }
      }
    }

    async function updateFreefirePrices() {
      const prices = {};
      let hasError = false;

      document.querySelectorAll('.price-input-ff').forEach(input => {
        const option = input.getAttribute('data-option');
        const value = parseFloat(input.value);
        
        if (isNaN(value) || value < 0) {
          alert(`Precio invÃ¡lido para la opciÃ³n ${option}`);
          hasError = true;
          return;
        }
        
        prices[option] = value;
      });

      if (hasError) return;

      try {
        const response = await fetch('/admin/update-game-prices', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            game_type: 'freefire_latam',
            prices: prices
          })
        });

        const data = await response.json();

        if (data.success) {
          alert('âœ… Precios de Free Fire Latam actualizados exitosamente');
        } else {
          alert('Error: ' + data.error);
        }
      } catch (error) {
        alert('Error al actualizar precios: ' + error);
      }
    }

    async function updateBlockStrikerPrices() {
      const prices = {};
      let hasError = false;

      document.querySelectorAll('.price-input-bs').forEach(input => {
        const option = input.getAttribute('data-option');
        const value = parseFloat(input.value);
        
        if (isNaN(value) || value < 0) {
          alert(`Precio invÃ¡lido para la opciÃ³n ${option}`);
          hasError = true;
          return;
        }
        
        prices[option] = value;
      });

      if (hasError) return;

      try {
        const response = await fetch('/admin/update-game-prices', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            game_type: 'block_striker',
            prices: prices
          })
        });

        const data = await response.json();

        if (data.success) {
          alert('âœ… Precios de Block Striker actualizados exitosamente');
        } else {
          alert('Error: ' + data.error);
        }
      } catch (error) {
        alert('Error al actualizar precios: ' + error);
      }
    }

    // Cargar precios actuales cuando se abre la pestaÃ±a
    document.addEventListener('DOMContentLoaded', function() {
      // Cargar precios automÃ¡ticamente cuando se carga la pÃ¡gina
      setTimeout(() => {
        loadCurrentPrices('freefire_latam');
        loadCurrentPrices('block_striker');
      }, 1000);
    });
  </script>
</body>
</html>